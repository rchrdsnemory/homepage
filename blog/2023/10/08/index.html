<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.3.353" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Tyler Burleigh" />
<meta name="description" content="In this post I’ll be tackling the Tidy Tuesday: US Government Grant Opportunities dataset. I’ll use GPT-4 to classify US grant-funding agencies into categories using government agency names. Then I’ll summarize how much agencies in each category are estimated to be giving out through grants." />

<title>Tyler Burleigh – Using GPT-4 for classification | Tyler Burleigh</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PRHQZ8HPLB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PRHQZ8HPLB', { 'anonymize_ip': true});
</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>


</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="/index.html">
    <span class="navbar-title">Tyler Burleigh</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
  aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"
  onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="/index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="/cv/index.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="/blog/index.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="/research/index.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/users/tylerburleigh" rel="me" target=""><i 
  class="bi bi-mastodon" 
  role="img" 
  aria-label="mastodon" 
>
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tylerburleigh" rel="me" target=""><i 
  class="bi bi-github" 
  role="img" 
  aria-label="github" 
>
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tylerburleigh" rel="me" target=""><i 
  class="bi bi-linkedin" 
  role="img" 
  aria-label="linkedin" 
>
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div id="quarto-toc-target"></div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default blog-post">
  <div class="quarto-title-banner">
    <div class="quarto-title column-body">
      <h1 class="title">Using GPT-4 for classification</h1>
                  <div>
        <div class="description">
          In this post I’ll be tackling the Tidy Tuesday: US Government Grant Opportunities dataset. I’ll use GPT-4 to classify US grant-funding agencies into categories using government agency names. Then I’ll summarize how much agencies in each category are estimated to be giving out through grants.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">GPT</div>
                <div class="quarto-category">classification</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.tylerburleigh.com/">Tyler Burleigh</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Sunday, October 8, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#load-libraries-and-data" id="toc-load-libraries-and-data">Load libraries and data</a></li>
  <li><a href="#gpt-function" id="toc-gpt-function">GPT function</a></li>
  <li><a href="#list-of-agencies" id="toc-list-of-agencies">List of agencies</a></li>
  <li><a href="#using-gpt-for-classification" id="toc-using-gpt-for-classification">Using GPT for classification</a></li>
  <li><a href="#ask-it-to-come-up-with-categories" id="toc-ask-it-to-come-up-with-categories">1. Ask it to come up with categories</a>
  <ul>
  <li><a href="#ask-it-to-classify-agencies-using-agency-names-and-categories" id="toc-ask-it-to-classify-agencies-using-agency-names-and-categories">2. Ask it to classify agencies using agency names and categories</a></li>
  <li><a href="#add-categories-to-dataframe" id="toc-add-categories-to-dataframe">Add categories to dataframe</a></li>
  </ul></li>
  <li><a href="#data-analysis" id="toc-data-analysis">Data analysis</a></li>
  </ul>
</nav>
<p>GPT is a powerful new tool in the Data Science toolkit. Used correctly, it can increase productivity while decreasing the “drudgery” of boring tasks like data cleaning. In this blog post, I use GPT to classify US grant-funding agencies into categories using government agency names. For this task I’ll be using this week’s Tidy Tuesday dataset: <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-10-03/readme.md">US Government Grant Opportunities</a>.</p>
<section id="load-libraries-and-data" class="level1">
<h1>Load libraries and data</h1>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keyring)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(numform)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(snakecase)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>grants <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-10-03/grants.csv&#39;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>grant_opportunity_details <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-10-03/grant_opportunity_details.csv&#39;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load cached ChatGPT results from disk</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;categories.Rdata&#39;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;agencies_categorized.Rdata&#39;</span>)</span></code></pre></div>
</div>
</section>
<section id="gpt-function" class="level1">
<h1>GPT function</h1>
<p>I’ll define a function for querying ChatGPT (<a href="https://www.listendata.com/2023/05/chatgpt-in-r.html">source</a>). This function will use GPT-4 as the model, and the temperature will be set to 0. Temperature defines how stable the responses will be. A temperature closer to 1 is better for creative tasks where high variability is desired, like creative writing. A temperature of 0 is more “boring” but also more stable. This is desirable for classification tasks.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ChatGPT function</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>chatGPT <span class="ot">&lt;-</span> <span class="cf">function</span>(prompt, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">modelName =</span> <span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">temperature =</span> <span class="dv">0</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">apiKey =</span> keyring<span class="sc">::</span><span class="fu">key_get</span>(<span class="st">&#39;openai&#39;</span>)) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">POST</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="st">&quot;https://api.openai.com/v1/chat/completions&quot;</span>, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_headers</span>(<span class="at">Authorization =</span> <span class="fu">paste</span>(<span class="st">&quot;Bearer&quot;</span>, apiKey)),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">content_type_json</span>(),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">encode =</span> <span class="st">&quot;json&quot;</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">body =</span> <span class="fu">list</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> modelName,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">temperature =</span> temperature,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">messages =</span> <span class="fu">list</span>(<span class="fu">list</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">role =</span> <span class="st">&quot;user&quot;</span>, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">content =</span> prompt</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">status_code</span>(response)<span class="sc">&gt;</span><span class="dv">200</span>) {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">content</span>(response))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trimws</span>(<span class="fu">content</span>(response)<span class="sc">$</span>choices[[<span class="dv">1</span>]]<span class="sc">$</span>message<span class="sc">$</span>content)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</section>
<section id="list-of-agencies" class="level1">
<h1>List of agencies</h1>
<p>I’ll generate a distinct list of US government agencies in the dataset, and then format them as a comma-separated string. This will make it easy to append to a prompt string when querying GPT.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>agencies <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(grants<span class="sc">$</span>agency_name))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(agencies,<span class="at">collapse =</span> <span class="st">&#39;, &#39;</span>) <span class="ot">-&gt;</span> agencies_str</span></code></pre></div>
</div>
</section>
<section id="using-gpt-for-classification" class="level1">
<h1>Using GPT for classification</h1>
<p>I’ll split the classification task into two parts:</p>
<ol type="1">
<li>Give GPT the full list of agency names, and ask it to come up with N categories</li>
<li>For each of the N categories, give GPT the full list of agency names, and ask it to identify the agencies that belong in each category</li>
</ol>
</section>
<section id="ask-it-to-come-up-with-categories" class="level1">
<h1>1. Ask it to come up with categories</h1>
<p>First I’ll ask GPT to define a fixed number of categories. Somewhat arbitrarily, I’ll ask for 10.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&#39;categories&#39;</span>)){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  query1 <span class="ot">&lt;-</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;I&#39;m going to present a list of US agencies. </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">  Your task is to identify the 10 best categories </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">  to represent them. The categories should be based </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="st">  on activities they&#39;re involved with, such as Defense </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="st">  and Military, Science and Technology, Arts and Culture, </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="st">  Health and Medicine, Education, International Aid, </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="st">  etc... I want you to give me the list of categories </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="st">  as a comma-separated list.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">  ```&quot;</span>, agencies_str, <span class="st">&quot;```&quot;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  gpt_categories <span class="ot">&lt;-</span> <span class="fu">chatGPT</span>(query1)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  categories <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">strsplit</span>(gpt_categories, <span class="st">&quot;,&quot;</span>)[[<span class="dv">1</span>]])</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save to disk</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(categories, <span class="at">file =</span> <span class="st">&#39;categories.Rdata&#39;</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(categories)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] &quot;Defense and Military&quot;                     
 [2] &quot;Science and Technology&quot;                   
 [3] &quot;Health and Medicine&quot;                      
 [4] &quot;International Aid&quot;                        
 [5] &quot;Education and Research&quot;                   
 [6] &quot;Agriculture and Environment&quot;              
 [7] &quot;Infrastructure and Transportation&quot;        
 [8] &quot;Business and Economic Development&quot;        
 [9] &quot;Arts and Culture&quot;                         
[10] &quot;Social Services and Community Development&quot;</code></pre>
</div>
</div>
<section id="ask-it-to-classify-agencies-using-agency-names-and-categories" class="level2">
<h2>2. Ask it to classify agencies using agency names and categories</h2>
<p>Next, using the agency names and categories generated above I’ll ask GPT to do classification. First, I’ll define a function that takes a category as input and runs a query against GPT asking it to put the agencies into the provided category, returning a list of agencies that it put in that category. Although I could ask GPT to classify agencies using all categories in a single query, I expect this would be less reliable than tackling each category separately. One of the trade-offs here is that I won’t get mutual exclusivity of the categories, since GPT won’t know how it’s already classified agencies. For this analysis, let’s assume I don’t want mutual exclusivity.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>get_agencies_in_category <span class="ot">&lt;-</span> <span class="cf">function</span>(category) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  query2 <span class="ot">&lt;-</span><span class="fu">paste0</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;I&#39;m going to present a comma-separated list of US agencies,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">  delimited by triple backticks (```), and a single category to </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">  which some of the agencies belong, delimited by triple hashtags (###). </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">  Your task is to provide a comma-separated list of agency names that </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">  belong in the category provided.</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">  ```&quot;</span>, agencies_str,  <span class="st">&quot;```</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">  ###&quot;</span>, category, <span class="st">&quot;###&quot;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  gpt_query2_response <span class="ot">&lt;-</span> <span class="fu">chatGPT</span>(query2)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return as a vector</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trimws</span>(<span class="fu">strsplit</span>(gpt_query2_response, <span class="st">&quot;,&quot;</span>)[[<span class="dv">1</span>]])</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Using the function above, I’ll query GPT for each of the categories, saving the results into a list called <code>agencies_categorized</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&#39;agencies_categorized&#39;</span>)){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  agencies_categorized <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (category <span class="cf">in</span> categories){</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(category <span class="sc">!=</span> <span class="st">&#39;Other&#39;</span>){</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      agencies_categorized[[category]] <span class="ot">&lt;-</span> <span class="fu">get_agencies_in_category</span>(category) </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save to disk</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(agencies_categorized, <span class="at">file =</span> <span class="st">&#39;agencies_categorized.Rdata&#39;</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(agencies_categorized)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Defense and Military`
 [1] &quot;69A345 Office of the Under Secretary for Policy&quot;   
 [2] &quot;69A350 OSDBU&quot;                                      
 [3] &quot;69A355 Research and Technology&quot;                    
 [4] &quot;ACC APG - Natick&quot;                                  
 [5] &quot;ACC-APG-Aberdeen Division A&quot;                       
 [6] &quot;ACC-APG-Belvoir&quot;                                   
 [7] &quot;ACC-APG-Detrick&quot;                                   
 [8] &quot;ACC-APG-Edgewood&quot;                                  
 [9] &quot;ACC-APG-Fort Huachuca&quot;                             
[10] &quot;Air Force -- Materiel Command&quot;                     
[11] &quot;Air Force -- Research Lab&quot;                         
[12] &quot;Air Force Academy&quot;                                 
[13] &quot;Air Force Office of Scientific Research&quot;           
[14] &quot;Alaska District&quot;                                   
[15] &quot;Army Contracting Command - Benet Laboratories&quot;     
[16] &quot;Army Contracting Command - New Jersey&quot;             
[17] &quot;Army Contracting Command Rock Island&quot;              
[18] &quot;Bureau of Diplomatic Security&quot;                     
[19] &quot;Bureau of International Security-Nonproliferation&quot; 
[20] &quot;Bureau of Political-Military Affairs - GPI&quot;        
[21] &quot;Bureau of Political-Military Affairs - WRA&quot;        
[22] &quot;DARPA - Biological Technologies Office&quot;            
[23] &quot;DARPA - Defense Sciences Office&quot;                   
[24] &quot;DARPA - Information Innovation Office&quot;             
[25] &quot;DARPA - Information Processing Technology Office&quot;  
[26] &quot;DARPA - Microsystems Technology Office&quot;            
[27] &quot;DARPA - Strategic Technology Office&quot;               
[28] &quot;DARPA - Tactical Technology Office&quot;                
[29] &quot;DARPA - Transformational Convergence Technology&quot;   
[30] &quot;DARPA-MTO-BAA-09-25&quot;                               
[31] &quot;Defense Advanced Research Projects Agency&quot;         
[32] &quot;Defense Health Agency&quot;                             
[33] &quot;Defense Intelligence Agency&quot;                       
[34] &quot;Defense Logistics Agency&quot;                          
[35] &quot;Defense Threat Reduction Agency&quot;                   
[36] &quot;Department of Defense&quot;                             
[37] &quot;Dept of the Army -- Materiel Command&quot;              
[38] &quot;Dept. of the Army  --  Corps of Engineers&quot;         
[39] &quot;Dept. of the Army -- Space &amp; Missle Defense Comman&quot;
[40] &quot;Dept. of the Army -- USAMRAA&quot;                      
[41] &quot;DoD Education Activity&quot;                            
[42] &quot;DOT - FAA Aviation Research Grants&quot;                
[43] &quot;DOT - FAA Centers of Excellence&quot;                   
[44] &quot;DOT Federal Aviation Administration&quot;               
[45] &quot;Engineer Research and Development Center&quot;          
[46] &quot;Fort Worth District&quot;                               
[47] &quot;Kansas City District&quot;                              
[48] &quot;Missile Defense Agency&quot;                            
[49] &quot;Mission and Install. Cmd. JBSA Ft. Sam Houston&quot;    
[50] &quot;NAVAIR&quot;                                            
[51] &quot;Naval Air Warfare Center Aircraft Div. Lakehurst&quot;  
[52] &quot;NAVAL FACILITIES ENGINEERING COMMAND&quot;              
[53] &quot;Naval Facilities Engineering Command Southwest&quot;    
[54] &quot;Naval Information Warfare Center Pacific&quot;          
[55] &quot;NAVAL MEDICAL LOGISTICS COMMAND&quot;                   
[56] &quot;Naval Research Laboratory&quot;                         
[57] &quot;Naval Supply Systems Command&quot;                      
[58] &quot;Naval Surface Warfare Center - Carderock&quot;          
[59] &quot;NAVFAC Atlantic&quot;                                   
[60] &quot;NAVFAC Washington DC&quot;                              
[61] &quot;NCA Contracting&quot;                                   
[62] &quot;NEA Cooperative Agreements Office&quot;                 
[63] &quot;NSWC - CRANE&quot;                                      
[64] &quot;NSWC Indian Head&quot;                                  
[65] &quot;NUWC Division Keyport&quot;                             
[66] &quot;Office of Local Defense Community Cooperation&quot;     
[67] &quot;Office of Naval Research&quot;                          
[68] &quot;Office of the Director of National Intelligence&quot;   
[69] &quot;Omaha District&quot;                                    
[70] &quot;Savannah District&quot;                                 
[71] &quot;Seattle District&quot;                                  
[72] &quot;SPAWAR SYSTEMS CENTER&quot;                             
[73] &quot;U.S. Dept. of Treasury RESTORE Act Program&quot;        
[74] &quot;U.S. Mission to NATO&quot;                              
[75] &quot;United States Coast Guard&quot;                         
[76] &quot;United States Marine Corps&quot;                        
[77] &quot;USAF 347 Contracting Squadron&quot;                     
[78] &quot;Washington Headquarters Services&quot;                  

$`Science and Technology`
 [1] &quot;69A345 Office of the Under Secretary for Policy&quot;   
 [2] &quot;69A355 Research and Technology&quot;                    
 [3] &quot;Advanced Research Projects Agency Energy&quot;          
 [4] &quot;Advanced Research Projects Agency for Health&quot;      
 [5] &quot;Agency for Health Care Research and Quality&quot;       
 [6] &quot;Agricultural Research Service&quot;                     
 [7] &quot;Air Force -- Research Lab&quot;                         
 [8] &quot;Air Force Office of Scientific Research&quot;           
 [9] &quot;Army Contracting Command - Benet Laboratories&quot;     
[10] &quot;Bureau of Oceans - Int. Environmental - Scientific&quot;
[11] &quot;Centers for Disease Control - ATSDR&quot;               
[12] &quot;Centers for Disease Control - CFA&quot;                 
[13] &quot;Centers for Disease Control - CGH&quot;                 
[14] &quot;Centers for Disease Control - CSELS&quot;               
[15] &quot;Centers for Disease Control - NCBDDD&quot;              
[16] &quot;Centers for Disease Control - NCCDPHP&quot;             
[17] &quot;Centers for Disease Control - NCEH&quot;                
[18] &quot;Centers for Disease Control - NCEZID&quot;              
[19] &quot;Centers for Disease Control - NCHHSTP&quot;             
[20] &quot;Centers for Disease Control - NCHS&quot;                
[21] &quot;Centers for Disease Control - NCIPC&quot;               
[22] &quot;Centers for Disease Control - NCIRD&quot;               
[23] &quot;Centers for Disease Control - NIOSH&quot;               
[24] &quot;Centers for Disease Control - OD&quot;                  
[25] &quot;Centers for Disease Control - OPHPR&quot;               
[26] &quot;Centers for Disease Control - OSTLTS&quot;              
[27] &quot;Centers for Disease Control and Prevention&quot;        
[28] &quot;Centers for Disease Control and Prevention - ERA&quot;  
[29] &quot;DARPA - Biological Technologies Office&quot;            
[30] &quot;DARPA - Defense Sciences Office&quot;                   
[31] &quot;DARPA - Information Innovation Office&quot;             
[32] &quot;DARPA - Information Processing Technology Office&quot;  
[33] &quot;DARPA - Microsystems Technology Office&quot;            
[34] &quot;DARPA - Strategic Technology Office&quot;               
[35] &quot;DARPA - Tactical Technology Office&quot;                
[36] &quot;DARPA - Transformational Convergence Technology&quot;   
[37] &quot;Defense Advanced Research Projects Agency&quot;         
[38] &quot;Defense Health Agency&quot;                             
[39] &quot;Defense Intelligence Agency&quot;                       
[40] &quot;Defense Threat Reduction Agency&quot;                   
[41] &quot;Department of Energy&quot;                              
[42] &quot;DoD Education Activity&quot;                            
[43] &quot;DOT - FAA Aviation Research Grants&quot;                
[44] &quot;DOT - FAA Centers of Excellence&quot;                   
[45] &quot;DOT Federal Aviation Administration&quot;               
[46] &quot;Economic Research Service&quot;                         
[47] &quot;Engineer Research and Development Center&quot;          
[48] &quot;Environmental Protection Agency&quot;                   
[49] &quot;FAA - Aviation Next Gen&quot;                           
[50] &quot;FAA-COE-AJFE&quot;                                      
[51] &quot;FAA-COE-GA&quot;                                        
[52] &quot;FAA-COE-TTHP&quot;                                      
[53] &quot;Food and Drug Administration&quot;                      
[54] &quot;Geological Survey&quot;                                 
[55] &quot;Health Resources and Services Administration&quot;      
[56] &quot;Indian Health Service&quot;                             
[57] &quot;Institute of Museum and Library Services&quot;          
[58] &quot;National Aeronautics and Space Administration&quot;     
[59] &quot;National Energy Technology Laboratory&quot;             
[60] &quot;National Geospatial-Intelligence Agency&quot;           
[61] &quot;National Highway Traffic Safety Administration&quot;    
[62] &quot;National Institute of Food and Agriculture&quot;        
[63] &quot;National Institute of Justice&quot;                     
[64] &quot;National Institute of Standards and Technology&quot;    
[65] &quot;National Institutes of Health&quot;                     
[66] &quot;National Oceanic and Atmospheric Administration&quot;   
[67] &quot;National Park Service&quot;                             
[68] &quot;National Science Foundation&quot;                       
[69] &quot;National Telecommunications and Information Admini&quot;
[70] &quot;Naval Research Laboratory&quot;                         
[71] &quot;Naval Supply Systems Command&quot;                      
[72] &quot;Naval Surface Warfare Center - Carderock&quot;          
[73] &quot;NNSA&quot;                                              
[74] &quot;Nuclear Regulatory Commission&quot;                     
[75] &quot;NUWC Division Keyport&quot;                             
[76] &quot;Oak Ridge Office&quot;                                  
[77] &quot;Office of Science&quot;                                 
[78] &quot;Office of the Assistant Secretary for Health&quot;      
[79] &quot;Office of the Director of National Intelligence&quot;   
[80] &quot;Office of the National Coordinator&quot;                
[81] &quot;Pipeline and Hazardous Materials Safety Admin&quot;     
[82] &quot;Risk Management Agency&quot;                            
[83] &quot;Science and Technology Directorate&quot;                
[84] &quot;Substance Abuse and Mental Health Services Admin&quot;  
[85] &quot;Substance Abuse and Mental Health Services Adminis&quot;
[86] &quot;Uniformed Services Univ. of the Health Sciences&quot;   
[87] &quot;USUHS Medical - Non- Research Projects&quot;            
[88] &quot;USUHS Medical Research Projects&quot;                   
[89] &quot;USAID&quot;                                             
[90] &quot;Woodrow Wilson Center&quot;                             

$`Health and Medicine`
 [1] &quot;Administration for Children &amp; Families - ACYF/FYSB&quot;
 [2] &quot;Administration for Children and Families&quot;          
 [3] &quot;Administration for Children and Families - ACYF/CB&quot;
 [4] &quot;Administration for Children and Families - ANA&quot;    
 [5] &quot;Administration for Children and Families - OCC&quot;    
 [6] &quot;Administration for Children and Families - OCS&quot;    
 [7] &quot;Administration for Children and Families - OCSE&quot;   
 [8] &quot;Administration for Children and Families - OFA&quot;    
 [9] &quot;Administration for Children and Families - OHS&quot;    
[10] &quot;Administration for Children and Families - OHSEPR&quot; 
[11] &quot;Administration for Children and Families - OPRE&quot;   
[12] &quot;Administration for Children and Families - ORR&quot;    
[13] &quot;Administration for Children and Families-IOAS-OTIP&quot;
[14] &quot;Administration for Community Living&quot;               
[15] &quot;Administration on Aging&quot;                           
[16] &quot;Advanced Research Projects Agency for Health&quot;      
[17] &quot;Agency for Health Care Research and Quality&quot;       
[18] &quot;Centers for Disease Control - ATSDR&quot;               
[19] &quot;Centers for Disease Control - CFA&quot;                 
[20] &quot;Centers for Disease Control - CGH&quot;                 
[21] &quot;Centers for Disease Control - CSELS&quot;               
[22] &quot;Centers for Disease Control - NCBDDD&quot;              
[23] &quot;Centers for Disease Control - NCCDPHP&quot;             
[24] &quot;Centers for Disease Control - NCEH&quot;                
[25] &quot;Centers for Disease Control - NCEZID&quot;              
[26] &quot;Centers for Disease Control - NCHHSTP&quot;             
[27] &quot;Centers for Disease Control - NCHS&quot;                
[28] &quot;Centers for Disease Control - NCIPC&quot;               
[29] &quot;Centers for Disease Control - NCIRD&quot;               
[30] &quot;Centers for Disease Control - NIOSH&quot;               
[31] &quot;Centers for Disease Control - OD&quot;                  
[32] &quot;Centers for Disease Control - OPHPR&quot;               
[33] &quot;Centers for Disease Control - OSTLTS&quot;              
[34] &quot;Centers for Disease Control and Prevention&quot;        
[35] &quot;Centers for Disease Control and Prevention - ERA&quot;  
[36] &quot;Centers for Medicare &amp; Medicaid Services&quot;          
[37] &quot;CMS Consumer Operated and Oriented Plan Program&quot;   
[38] &quot;CMS-Consumer Information &amp; Insurance Oversight&quot;    
[39] &quot;Defense Health Agency&quot;                             
[40] &quot;Department of Health and Human Services&quot;           
[41] &quot;Food and Drug Administration&quot;                      
[42] &quot;Health Resources and Services Administration&quot;      
[43] &quot;Indian Health Service&quot;                             
[44] &quot;National Institute of Food and Agriculture&quot;        
[45] &quot;National Institutes of Health&quot;                     
[46] &quot;Office of the Assistant Secretary for Health&quot;      
[47] &quot;Office of the National Coordinator&quot;                
[48] &quot;Substance Abuse and Mental Health Services Admin&quot;  
[49] &quot;Substance Abuse and Mental Health Services Adminis&quot;
[50] &quot;Uniformed Services Univ. of the Health Sciences&quot;   
[51] &quot;USUHS Medical - Non- Research Projects&quot;            
[52] &quot;USUHS Medical Research Projects&quot;                   
[53] &quot;VA Office of Mental Health&quot;                        
[54] &quot;VHA Member Services-Veterans Transportation&quot;       

$`International Aid`
 [1] &quot;Afghanistan USAID-Kabul&quot;                        
 [2] &quot;Africa Regional Services&quot;                       
 [3] &quot;Agency for International Development&quot;           
 [4] &quot;Albania USAID-Tirana&quot;                           
 [5] &quot;Armenia USAID-Yerevan&quot;                          
 [6] &quot;Azerbaijan USAID-Baku&quot;                          
 [7] &quot;Bangladesh USAID-Dhaka&quot;                         
 [8] &quot;Benin USAID-Cotonou&quot;                            
 [9] &quot;Bolivia USAID-La Paz&quot;                           
[10] &quot;Bosnia USAID-Herzegovina&quot;                       
[11] &quot;Brazil USAID-Brasilia&quot;                          
[12] &quot;Burma USAID - Rangoon&quot;                          
[13] &quot;Burundi USAID-Bujumbura&quot;                        
[14] &quot;Cambodia USAID-Phnom Penh&quot;                      
[15] &quot;Colombia USAID-Bogota&quot;                          
[16] &quot;Democratic Republic of the Congo USAID-Kinshasa&quot;
[17] &quot;Dominican Republic USAID-Santo Domingo&quot;         
[18] &quot;East Africa USAID-Kenya&quot;                        
[19] &quot;Ecuador USAID-Quito&quot;                            
[20] &quot;Egypt USAID-Cairo&quot;                              
[21] &quot;El Salvador USAID-San Salvador&quot;                 
[22] &quot;Ethiopia USAID-Addis Ababa&quot;                     
[23] &quot;Georgia USAID-Tbilisi&quot;                          
[24] &quot;Ghana USAID-Accra&quot;                              
[25] &quot;Guatemala USAID-Guatemala City&quot;                 
[26] &quot;Guinea USAID-Conakry&quot;                           
[27] &quot;Haiti USAID-Port Au Prince&quot;                     
[28] &quot;Honduras USAID-Tegucigalpa&quot;                     
[29] &quot;Hungary USAID-Budapest&quot;                         
[30] &quot;India USAID-New Delhi&quot;                          
[31] &quot;Indonesia USAID-Jakarta&quot;                        
[32] &quot;Iraq Assistance Office&quot;                         
[33] &quot;Iraq USAID-Baghdad&quot;                             
[34] &quot;Jamaica USAID-Kingston&quot;                         
[35] &quot;Jordan USAID-Amman&quot;                             
[36] &quot;Kazakhstan USAID-Almaty&quot;                        
[37] &quot;Kenya USAID-Nairobi&quot;                            
[38] &quot;Kosovo USAID-Pristina&quot;                          
[39] &quot;Lebanon USAID-Beirut&quot;                           
[40] &quot;Liberia USAID-Monrovia&quot;                         
[41] &quot;Macedonia USAID-Skopje&quot;                         
[42] &quot;Madagascar USAID-Antananarivo&quot;                  
[43] &quot;Malawi USAID-Lilongwe&quot;                          
[44] &quot;Mali USAID -Bamako&quot;                             
[45] &quot;Mexico USAID-Mexico City&quot;                       
[46] &quot;Middle East Regional Platform USAID-MERP&quot;       
[47] &quot;Moldova USAID-Chisinau&quot;                         
[48] &quot;Mongolia USAID-Ulaanbaatar&quot;                     
[49] &quot;Morocco USAID-Rabat&quot;                            
[50] &quot;Mozambique USAID-Maputo&quot;                        
[51] &quot;Nepal USAID-Kathmandu&quot;                          
[52] &quot;Nicaragua USAID-Managua&quot;                        
[53] &quot;Nigeria USAID-Abuja&quot;                            
[54] &quot;Pakistan USAID-Islamabad&quot;                       
[55] &quot;Panama USAID-Panama City&quot;                       
[56] &quot;Paraguay USAID-Asuncion&quot;                        
[57] &quot;Peru USAID-Lima&quot;                                
[58] &quot;Philippines USAID-Manila&quot;                       
[59] &quot;Rwanda USAID-Kigali&quot;                            
[60] &quot;Senegal USAID-Dakar&quot;                            
[61] &quot;Serbia USAID-Belgrade&quot;                          
[62] &quot;South Africa USAID-Pretoria&quot;                    
[63] &quot;South Sudan (USAID)-Juba&quot;                       
[64] &quot;Sri Lanka USAID-Colombo&quot;                        
[65] &quot;Sudan USAID-Khartoum&quot;                           
[66] &quot;Tajikistan USAID-Dushanbe&quot;                      
[67] &quot;Tanzania USAID-Dar es Salaam&quot;                   
[68] &quot;Thailand USAID-Bangkok&quot;                         
[69] &quot;Uganda USAID-Kampala&quot;                           
[70] &quot;Ukraine USAID-Kiev&quot;                             
[71] &quot;Uzbekistan USAID-Tashkent&quot;                      
[72] &quot;West Africa USAID-Ghana&quot;                        
[73] &quot;West Bank&quot;                                      
[74] &quot;Gaza USAID-West Bank&quot;                           
[75] &quot;Yemen USAID-Sanaa&quot;                              
[76] &quot;Zambia USAID-Lusaka&quot;                            
[77] &quot;Zimbabwe USAID-Harare&quot;                          
[78] &quot;USAID&quot;                                          
[79] &quot;USAID - Barbados and Eastern Caribbean&quot;         
[80] &quot;USAID-VIETNAM&quot;                                  

$`Education and Research`
  [1] &quot;Advanced Research Projects Agency Energy&quot;          
  [2] &quot;Advanced Research Projects Agency for Health&quot;      
  [3] &quot;Agency for Health Care Research and Quality&quot;       
  [4] &quot;Air Force Academy&quot;                                 
  [5] &quot;Air Force Office of Scientific Research&quot;           
  [6] &quot;Army Contracting Command - Benet Laboratories&quot;     
  [7] &quot;Bureau Of Educational and Cultural Affairs&quot;        
  [8] &quot;Centers for Disease Control - ATSDR&quot;               
  [9] &quot;Centers for Disease Control - CFA&quot;                 
 [10] &quot;Centers for Disease Control - CGH&quot;                 
 [11] &quot;Centers for Disease Control - CSELS&quot;               
 [12] &quot;Centers for Disease Control - NCBDDD&quot;              
 [13] &quot;Centers for Disease Control - NCCDPHP&quot;             
 [14] &quot;Centers for Disease Control - NCEH&quot;                
 [15] &quot;Centers for Disease Control - NCEZID&quot;              
 [16] &quot;Centers for Disease Control - NCHHSTP&quot;             
 [17] &quot;Centers for Disease Control - NCHS&quot;                
 [18] &quot;Centers for Disease Control - NCIPC&quot;               
 [19] &quot;Centers for Disease Control - NCIRD&quot;               
 [20] &quot;Centers for Disease Control - NIOSH&quot;               
 [21] &quot;Centers for Disease Control - OD&quot;                  
 [22] &quot;Centers for Disease Control - OPHPR&quot;               
 [23] &quot;Centers for Disease Control - OSTLTS&quot;              
 [24] &quot;Centers for Disease Control and Prevention&quot;        
 [25] &quot;Centers for Disease Control and Prevention - ERA&quot;  
 [26] &quot;Centers for Medicare &amp; Medicaid Services&quot;          
 [27] &quot;Chief Evaluation Office&quot;                           
 [28] &quot;CMS Consumer Operated and Oriented Plan Program&quot;   
 [29] &quot;CMS-Consumer Information &amp; Insurance Oversight&quot;    
 [30] &quot;DARPA - Biological Technologies Office&quot;            
 [31] &quot;DARPA - Defense Sciences Office&quot;                   
 [32] &quot;DARPA - Information Innovation Office&quot;             
 [33] &quot;DARPA - Information Processing Technology Office&quot;  
 [34] &quot;DARPA - Microsystems Technology Office&quot;            
 [35] &quot;DARPA - Strategic Technology Office&quot;               
 [36] &quot;DARPA - Tactical Technology Office&quot;                
 [37] &quot;DARPA - Transformational Convergence Technology&quot;   
 [38] &quot;DARPA-MTO-BAA-09-25&quot;                               
 [39] &quot;Defense Advanced Research Projects Agency&quot;         
 [40] &quot;Defense Health Agency&quot;                             
 [41] &quot;Defense Intelligence Agency&quot;                       
 [42] &quot;Department of Education&quot;                           
 [43] &quot;DoD Education Activity&quot;                            
 [44] &quot;DOT - FAA Aviation Research Grants&quot;                
 [45] &quot;DOT - FAA Centers of Excellence&quot;                   
 [46] &quot;DOT Federal Aviation Administration&quot;               
 [47] &quot;Economic Research Service&quot;                         
 [48] &quot;Engineer Research and Development Center&quot;          
 [49] &quot;FAA - Aviation Next Gen&quot;                           
 [50] &quot;FAA-COE-AJFE&quot;                                      
 [51] &quot;FAA-COE-GA&quot;                                        
 [52] &quot;FAA-COE-TTHP&quot;                                      
 [53] &quot;Faculty Exchange Program 10.613&quot;                   
 [54] &quot;Fish and Wildlife Service&quot;                         
 [55] &quot;Fisheries &amp; Habitat Conservation&quot;                  
 [56] &quot;Food and Drug Administration&quot;                      
 [57] &quot;Food and Nutrition Service&quot;                        
 [58] &quot;Food Safety Inspection Service&quot;                    
 [59] &quot;Foreign Agricultural Service&quot;                      
 [60] &quot;Forest Service&quot;                                    
 [61] &quot;Geological Survey&quot;                                 
 [62] &quot;Health Resources and Services Administration&quot;      
 [63] &quot;Indian Health Service&quot;                             
 [64] &quot;Institute of Museum and Library Services&quot;          
 [65] &quot;Internal Revenue Service&quot;                          
 [66] &quot;International Agricultural Educ Fellowship 10.619&quot; 
 [67] &quot;Library of Congress&quot;                               
 [68] &quot;NASA Ames Research Center&quot;                         
 [69] &quot;NASA Armstrong Flight Research Center&quot;             
 [70] &quot;NASA Glenn Research Center&quot;                        
 [71] &quot;NASA Goddard Space Flight Center&quot;                  
 [72] &quot;NASA Headquarters&quot;                                 
 [73] &quot;NASA Johnson Space Center&quot;                         
 [74] &quot;NASA Kennedy Space Center&quot;                         
 [75] &quot;NASA Langley Research Center&quot;                      
 [76] &quot;NASA Marshall Space Flight Center&quot;                 
 [77] &quot;NASA Stennis Space Center&quot;                         
 [78] &quot;National Aeronautics and Space Administration&quot;     
 [79] &quot;National Archives and Records Administration&quot;      
 [80] &quot;National Endowment for the Arts&quot;                   
 [81] &quot;National Endowment for the Humanities&quot;             
 [82] &quot;National Energy Technology Laboratory&quot;             
 [83] &quot;National Geospatial-Intelligence Agency&quot;           
 [84] &quot;National Highway Traffic Safety Administration&quot;    
 [85] &quot;National Institute of Corrections&quot;                 
 [86] &quot;National Institute of Food and Agriculture&quot;        
 [87] &quot;National Institute of Justice&quot;                     
 [88] &quot;National Institute of Standards and Technology&quot;    
 [89] &quot;National Institutes of Health&quot;                     
 [90] &quot;National Oceanic and Atmospheric Administration&quot;   
 [91] &quot;National Park Service&quot;                             
 [92] &quot;National Science Foundation&quot;                       
 [93] &quot;National Telecommunications and Information Admini&quot;
 [94] &quot;National Veterans Sports Programs&quot;                 
 [95] &quot;Natural Resources Conservation Service&quot;            
 [96] &quot;Naval Research Laboratory&quot;                         
 [97] &quot;Nuclear Regulatory Commission&quot;                     
 [98] &quot;Office of Science&quot;                                 
 [99] &quot;Office of the Assistant Secretary for Health&quot;      
[100] &quot;Office of the Director of National Intelligence&quot;   
[101] &quot;Office of the National Coordinator&quot;                
[102] &quot;Office of the Secretary&quot;                           
[103] &quot;Occupational Safety and Health Administration&quot;     
[104] &quot;Pipeline and Hazardous Materials Safety Admin&quot;     
[105] &quot;Risk Management Agency&quot;                            
[106] &quot;Risk Management Education&quot;                         
[107] &quot;Rural Business-Cooperative Service&quot;                
[108] &quot;Rural Housing Service&quot;                             
[109] &quot;Rural Utilities Service&quot;                           
[110] &quot;Scientific Cooperation and Research 10.961&quot;        
[111] &quot;Social Security Administration&quot;                    
[112] &quot;Substance Abuse and Mental Health Services Admin&quot;  
[113] &quot;Substance Abuse and Mental Health Services Adminis&quot;
[114] &quot;Technical Agricultural Assistance 10.960&quot;          
[115] &quot;Uniformed Services Univ. of the Health Sciences&quot;   
[116] &quot;USUHS Medical - Non- Research Projects&quot;            
[117] &quot;USUHS Medical Research Projects&quot;                   
[118] &quot;Veterans Employment and Training Service&quot;          
[119] &quot;Volunteer Income Tax Assistance&quot;                   
[120] &quot;Woodrow Wilson Center&quot;                             

$`Agriculture and Environment`
 [1] &quot;Agricultural Marketing Service&quot;                    
 [2] &quot;Agricultural Trade Promotion Program 10.618&quot;       
 [3] &quot;Animal and Plant Health Inspection Service&quot;        
 [4] &quot;Bureau of Land Management&quot;                         
 [5] &quot;Bureau of Ocean Energy Management&quot;                 
 [6] &quot;Bureau of Reclamation&quot;                             
 [7] &quot;Bureau of Reclamation - Denver Office&quot;             
 [8] &quot;Bureau of Reclamation - Great Plains Region&quot;       
 [9] &quot;Bureau of Reclamation - Lower Colorado Region&quot;     
[10] &quot;Bureau of Reclamation - Mid-Pacific Region&quot;        
[11] &quot;Bureau of Reclamation - Pacific Northwest Region&quot;  
[12] &quot;Bureau of Reclamation - Upper Colorado Region&quot;     
[13] &quot;Bureau of Reclamation-Upper Columbia Area Office&quot;  
[14] &quot;Bureau of Reclamation&quot;                             
[15] &quot;Denver Office&quot;                                     
[16] &quot;Bureau of Reclamation&quot;                             
[17] &quot;Mid-Pacific Regional Office&quot;                       
[18] &quot;Bureau of Safety and Environmental Enforcement&quot;    
[19] &quot;Department of Agriculture&quot;                         
[20] &quot;Endangered Species&quot;                                
[21] &quot;Environmental Management Consolidated Business Cen&quot;
[22] &quot;Environmental Protection Agency&quot;                   
[23] &quot;Farm Production and Conservation Business Center&quot;  
[24] &quot;Farm Service Agency&quot;                               
[25] &quot;Fish and Wildlife Service&quot;                         
[26] &quot;Fisheries &amp; Habitat Conservation&quot;                  
[27] &quot;Forest Service&quot;                                    
[28] &quot;Migratory Birds&quot;                                   
[29] &quot;National Energy Technology Laboratory&quot;             
[30] &quot;National Oceanic and Atmospheric Administration&quot;   
[31] &quot;Natural Resources Conservation Service&quot;            
[32] &quot;Office of Science&quot;                                 
[33] &quot;Risk Management Agency&quot;                            
[34] &quot;Rural Business-Cooperative Service&quot;                
[35] &quot;Rural Housing Service&quot;                             
[36] &quot;Rural Utilities Service&quot;                           

$`Infrastructure and Transportation`
  [1] &quot;```69A345 Office of the Under Secretary for Policy&quot;
  [2] &quot;69A350 OSDBU&quot;                                      
  [3] &quot;69A355 Research and Technology&quot;                    
  [4] &quot;ACC APG - Natick&quot;                                  
  [5] &quot;ACC-APG-Aberdeen Division A&quot;                       
  [6] &quot;ACC-APG-Belvoir&quot;                                   
  [7] &quot;ACC-APG-Detrick&quot;                                   
  [8] &quot;ACC-APG-Edgewood&quot;                                  
  [9] &quot;ACC-APG-Fort Huachuca&quot;                             
 [10] &quot;Air Force -- Materiel Command&quot;                     
 [11] &quot;Air Force -- Research Lab&quot;                         
 [12] &quot;Air Force Academy&quot;                                 
 [13] &quot;Air Force Office of Scientific Research&quot;           
 [14] &quot;Airport Improvement Program Discretionary Grants&quot;  
 [15] &quot;Alaska District&quot;                                   
 [16] &quot;Army Contracting Command - Benet Laboratories&quot;     
 [17] &quot;Army Contracting Command - New Jersey&quot;             
 [18] &quot;Army Contracting Command Rock Island&quot;              
 [19] &quot;Bureau of Land Management&quot;                         
 [20] &quot;Bureau of Ocean Energy Management&quot;                 
 [21] &quot;Bureau of Reclamation&quot;                             
 [22] &quot;Bureau of Reclamation - Denver Office&quot;             
 [23] &quot;Bureau of Reclamation - Great Plains Region&quot;       
 [24] &quot;Bureau of Reclamation - Lower Colorado Region&quot;     
 [25] &quot;Bureau of Reclamation - Mid-Pacific Region&quot;        
 [26] &quot;Bureau of Reclamation - Pacific Northwest Region&quot;  
 [27] &quot;Bureau of Reclamation - Upper Colorado Region&quot;     
 [28] &quot;Bureau of Reclamation-Upper Columbia Area Office&quot;  
 [29] &quot;Bureau of Reclamation&quot;                             
 [30] &quot;Denver Office&quot;                                     
 [31] &quot;Bureau of Reclamation&quot;                             
 [32] &quot;Mid-Pacific Regional Office&quot;                       
 [33] &quot;Bureau of Safety and Environmental Enforcement&quot;    
 [34] &quot;Chicago Service Center&quot;                            
 [35] &quot;DARPA - Biological Technologies Office&quot;            
 [36] &quot;DARPA - Defense Sciences Office&quot;                   
 [37] &quot;DARPA - Information Innovation Office&quot;             
 [38] &quot;DARPA - Information Processing Technology Office&quot;  
 [39] &quot;DARPA - Microsystems Technology Office&quot;            
 [40] &quot;DARPA - Strategic Technology Office&quot;               
 [41] &quot;DARPA - Tactical Technology Office&quot;                
 [42] &quot;DARPA - Transformational Convergence Technology&quot;   
 [43] &quot;Defense Advanced Research Projects Agency&quot;         
 [44] &quot;Defense Health Agency&quot;                             
 [45] &quot;Defense Intelligence Agency&quot;                       
 [46] &quot;Defense Logistics Agency&quot;                          
 [47] &quot;Defense Threat Reduction Agency&quot;                   
 [48] &quot;Department of Transportation&quot;                      
 [49] &quot;Dept of the Army -- Materiel Command&quot;              
 [50] &quot;Dept. of the Army  --  Corps of Engineers&quot;         
 [51] &quot;Dept. of the Army -- Space &amp; Missle Defense Comman&quot;
 [52] &quot;Dept. of the Army -- USAMRAA&quot;                      
 [53] &quot;DOT - FAA Aviation Research Grants&quot;                
 [54] &quot;DOT - FAA Centers of Excellence&quot;                   
 [55] &quot;DOT - Federal Railroad Administration&quot;             
 [56] &quot;DOT Federal Aviation Administration&quot;               
 [57] &quot;DOT Federal Highway Administration&quot;                
 [58] &quot;DOT OSDBU&quot;                                         
 [59] &quot;DOT-Federal Motor Carrier Safety Administration&quot;   
 [60] &quot;DOT-Federal Transit Administration - Inactive Site&quot;
 [61] &quot;DOT/Federal Transit Administration&quot;                
 [62] &quot;Economic Development Administration&quot;               
 [63] &quot;Engineer Research and Development Center&quot;          
 [64] &quot;FAA - Aviation Next Gen&quot;                           
 [65] &quot;FAA-COE-AJFE&quot;                                      
 [66] &quot;FAA-COE-GA&quot;                                        
 [67] &quot;FAA-COE-TTHP&quot;                                      
 [68] &quot;Federal Communications Commission&quot;                 
 [69] &quot;Federal Mediation and Conciliation Service&quot;        
 [70] &quot;Federal Motor Carrier Safety Administration&quot;       
 [71] &quot;Federal Transit Administration&quot;                    
 [72] &quot;Fort Worth District&quot;                               
 [73] &quot;Kansas City District&quot;                              
 [74] &quot;Maritime Administration&quot;                           
 [75] &quot;NASA Ames Research Center&quot;                         
 [76] &quot;NASA Armstrong Flight Research Center&quot;             
 [77] &quot;NASA Glenn Research Center&quot;                        
 [78] &quot;NASA Goddard Space Flight Center&quot;                  
 [79] &quot;NASA Headquarters&quot;                                 
 [80] &quot;NASA Johnson Space Center&quot;                         
 [81] &quot;NASA Kennedy Space Center&quot;                         
 [82] &quot;NASA Langley Research Center&quot;                      
 [83] &quot;NASA Marshall Space Flight Center&quot;                 
 [84] &quot;NASA Stennis Space Center&quot;                         
 [85] &quot;National Aeronautics and Space Administration&quot;     
 [86] &quot;National Highway Traffic Safety Administration&quot;    
 [87] &quot;National Oceanic and Atmospheric Administration&quot;   
 [88] &quot;National Telecommunications and Information Admini&quot;
 [89] &quot;Naval Air Warfare Center Aircraft Div. Lakehurst&quot;  
 [90] &quot;NAVAL FACILITIES ENGINEERING COMMAND&quot;              
 [91] &quot;Naval Facilities Engineering Command Southwest&quot;    
 [92] &quot;Naval Information Warfare Center Pacific&quot;          
 [93] &quot;NAVAL MEDICAL LOGISTICS COMMAND&quot;                   
 [94] &quot;Naval Research Laboratory&quot;                         
 [95] &quot;Naval Supply Systems Command&quot;                      
 [96] &quot;Naval Surface Warfare Center - Carderock&quot;          
 [97] &quot;NAVFAC Atlantic&quot;                                   
 [98] &quot;NAVFAC Washington DC&quot;                              
 [99] &quot;NCA Contracting&quot;                                   
[100] &quot;Nebraska State Office&quot;                             
[101] &quot;Nuclear Regulatory Commission&quot;                     
[102] &quot;NUWC Division Keyport&quot;                             
[103] &quot;Office of Local Defense Community Cooperation&quot;     
[104] &quot;Office of the Secretary&quot;                           
[105] &quot;Omaha District&quot;                                    
[106] &quot;Pipeline and Hazardous Materials Safety Admin&quot;     
[107] &quot;Region 1&quot;                                          
[108] &quot;Region 10&quot;                                         
[109] &quot;Region 2&quot;                                          
[110] &quot;Region 3&quot;                                          
[111] &quot;Region 4&quot;                                          
[112] &quot;Region 5&quot;                                          
[113] &quot;Region 6&quot;                                          
[114] &quot;Region 7&quot;                                          
[115] &quot;Region 8&quot;                                          
[116] &quot;Region 9&quot;                                          
[117] &quot;Risk Management Agency&quot;                            
[118] &quot;Rural Utilities Service&quot;                           
[119] &quot;Savannah District&quot;                                 
[120] &quot;Seattle District&quot;                                  
[121] &quot;SPAWAR SYSTEMS CENTER&quot;                             
[122] &quot;Transportation Security Administration&quot;            
[123] &quot;U.S. Dept. of Treasury RESTORE Act Program&quot;        
[124] &quot;United States Coast Guard&quot;                         
[125] &quot;United States Marine Corps&quot;                        
[126] &quot;USACE Portland District&quot;                           
[127] &quot;USAF 347 Contracting Squadron&quot;                     
[128] &quot;Walla Walla District&quot;                              
[129] &quot;Washington Headquarters Services```&quot;               

$`Business and Economic Development`
 [1] &quot;Economic Development Administration&quot;               
 [2] &quot;Small Business Administration&quot;                     
 [3] &quot;Community Development Financial Institutions&quot;      
 [4] &quot;Rural Business-Cooperative Service&quot;                
 [5] &quot;Employment and Training Administration&quot;            
 [6] &quot;Office of Local Defense Community Cooperation&quot;     
 [7] &quot;Economic Research Service&quot;                         
 [8] &quot;Agricultural Marketing Service&quot;                    
 [9] &quot;Agricultural Trade Promotion Program 10.618&quot;       
[10] &quot;Bureau of Economic and Business Affairs&quot;           
[11] &quot;Trade Policy and Geographic Affairs&quot;               
[12] &quot;Market Access Program 10.601&quot;                      
[13] &quot;Foreign Agricultural Service&quot;                      
[14] &quot;Foreign Market Development Cooperator Prog 10600&quot;  
[15] &quot;Technical Assistance for Specialty Crops 10.604&quot;   
[16] &quot;Jobs and Innovation Accelerator Challenge&quot;         
[17] &quot;Energy Cluster Program&quot;                            
[18] &quot;DOT - FAA Centers of Excellence&quot;                   
[19] &quot;DOT Federal Highway Administration&quot;                
[20] &quot;DOT OSDBU&quot;                                         
[21] &quot;DOT-Federal Motor Carrier Safety Administration&quot;   
[22] &quot;DOT-Federal Transit Administration - Inactive Site&quot;
[23] &quot;DOT/Federal Transit Administration&quot;                
[24] &quot;Federal Communications Commission&quot;                 
[25] &quot;National Business Center&quot;                          
[26] &quot;National Telecommunications and Information Admini&quot;
[27] &quot;U.S. Dept. of Treasury RESTORE Act Program&quot;        
[28] &quot;Volunteer Income Tax Assistance&quot;                   
[29] &quot;Low Income Taxpayer Clinic&quot;                        
[30] &quot;Tax Counseling for the Elderly&quot;                    
[31] &quot;CMS Consumer Operated and Oriented Plan Program&quot;   
[32] &quot;CMS-Consumer Information &amp; Insurance Oversight&quot;    
[33] &quot;Office of Acquisitions Management&quot;                 
[34] &quot;Office of Procurement Operations - Grants Division&quot;
[35] &quot;Office of the Secretary&quot;                           
[36] &quot;Office on Violence Against Women&quot;                  
[37] &quot;Veterans Employment and Training Service&quot;          
[38] &quot;Veterans Employment Pay for Success&quot;               
[39] &quot;Office of Disability Employment Policy&quot;            
[40] &quot;Office of Partnerships and Public Engagements&quot;     
[41] &quot;Risk Management Agency&quot;                            
[42] &quot;Risk Management Education&quot;                         
[43] &quot;Office of the Assistant Secretary for Health&quot;      
[44] &quot;Office of the National Coordinator&quot;                
[45] &quot;Office of the Director of National Intelligence&quot;   
[46] &quot;Office of the Middle East Partnership Initiative&quot;  
[47] &quot;Office to Monitor-Combat Trafficking in Persons&quot;   
[48] &quot;Office of Global Womens Issues&quot;                    
[49] &quot;Office of Global Criminal Justice&quot;                 
[50] &quot;Office of Justice Programs&quot;                        
[51] &quot;Office of Juvenile Justice Delinquency Prevention&quot; 
[52] &quot;Office for Victims of Crime&quot;                       
[53] &quot;Office of Science&quot;                                 
[54] &quot;Office of Surface Mining&quot;                          
[55] &quot;Office of Mental Health and Suicide Prevention&quot;    
[56] &quot;Office of National Drug Control Policy&quot;            
[57] &quot;Office of the Secretary&quot;                           
[58] &quot;Office of Policy ORES&quot;                             
[59] &quot;Office of Acquisitions Management&quot;                 
[60] &quot;Office of Procurement Operations - Grants Division&quot;
[61] &quot;Office of the Secretary&quot;                           
[62] &quot;Office on Violence Against Women&quot;                  
[63] &quot;Veterans Employment and Training Service&quot;          
[64] &quot;Veterans Employment Pay for Success&quot;               
[65] &quot;Office of Disability Employment Policy&quot;            
[66] &quot;Office of Partnerships and Public Engagements&quot;     
[67] &quot;Risk Management Agency&quot;                            
[68] &quot;Risk Management Education&quot;                         
[69] &quot;Office of the Assistant Secretary for Health&quot;      
[70] &quot;Office of the National Coordinator&quot;                
[71] &quot;Office of the Director of National Intelligence&quot;   
[72] &quot;Office of the Middle East Partnership Initiative&quot;  
[73] &quot;Office to Monitor-Combat Trafficking in Persons&quot;   
[74] &quot;Office of Global Womens Issues&quot;                    
[75] &quot;Office of Global Criminal Justice&quot;                 
[76] &quot;Office of Justice Programs&quot;                        
[77] &quot;Office of Juvenile Justice Delinquency Prevention&quot; 
[78] &quot;Office for Victims of Crime&quot;                       
[79] &quot;Office of Science&quot;                                 
[80] &quot;Office of Surface Mining&quot;                          
[81] &quot;Office of Mental Health and Suicide Prevention&quot;    
[82] &quot;Office of National Drug Control Policy&quot;            

$`Arts and Culture`
[1] &quot;National Endowment for the Arts&quot;             
[2] &quot;National Endowment for the Humanities&quot;       
[3] &quot;Institute of Museum and Library Services&quot;    
[4] &quot;Library of Congress&quot;                         
[5] &quot;National Archives and Records Administration&quot;
[6] &quot;Smithsonian Institution&quot;                     

$`Social Services and Community Development`
 [1] &quot;Administration for Children &amp; Families - ACYF/FYSB&quot;
 [2] &quot;Administration for Children and Families&quot;          
 [3] &quot;Administration for Children and Families - ACYF/CB&quot;
 [4] &quot;Administration for Children and Families - ANA&quot;    
 [5] &quot;Administration for Children and Families - OCC&quot;    
 [6] &quot;Administration for Children and Families - OCS&quot;    
 [7] &quot;Administration for Children and Families - OCSE&quot;   
 [8] &quot;Administration for Children and Families - OFA&quot;    
 [9] &quot;Administration for Children and Families - OHS&quot;    
[10] &quot;Administration for Children and Families - OHSEPR&quot; 
[11] &quot;Administration for Children and Families - OPRE&quot;   
[12] &quot;Administration for Children and Families - ORR&quot;    
[13] &quot;Administration for Children and Families-IOAS-OTIP&quot;
[14] &quot;Administration for Community Living&quot;               
[15] &quot;Administration on Aging&quot;                           
[16] &quot;AmeriCorps&quot;                                        
[17] &quot;Community Capacity Development Office&quot;             
[18] &quot;Community Development Financial Institutions&quot;      
[19] &quot;Community Oriented Policing Services&quot;              
[20] &quot;Corporation for National and Community Service&quot;    
[21] &quot;Department of Housing and Urban Development&quot;       
[22] &quot;Employment and Training Administration&quot;            
[23] &quot;Health Resources and Services Administration&quot;      
[24] &quot;Homeless Providers Grant and Per Diem Program&quot;     
[25] &quot;Housing and Urban Development&quot;                     
[26] &quot;Office of Juvenile Justice Delinquency Prevention&quot; 
[27] &quot;Office of Local Defense Community Cooperation&quot;     
[28] &quot;Office of the Assistant Secretary for Health&quot;      
[29] &quot;Office on Violence Against Women&quot;                  
[30] &quot;Rural Business-Cooperative Service&quot;                
[31] &quot;Rural Housing Service&quot;                             
[32] &quot;Rural Utilities Service&quot;                           
[33] &quot;Social Security Administration&quot;                    
[34] &quot;Substance Abuse and Mental Health Services Admin&quot;  
[35] &quot;Substance Abuse and Mental Health Services Adminis&quot;
[36] &quot;Supportive Services for Veteran Families&quot;          
[37] &quot;Veterans Employment and Training Service&quot;          
[38] &quot;Veterans Employment Pay for Success&quot;               
[39] &quot;Veterans Legacy Grants Program&quot;                    
[40] &quot;Volunteer Income Tax Assistance&quot;                   
[41] &quot;Womens Bureau&quot;                                     </code></pre>
</div>
</div>
</section>
<section id="add-categories-to-dataframe" class="level2">
<h2>Add categories to dataframe</h2>
<p>Finally, I’ll add the category labels to the <code>grant_opportunity_details</code> dataframe. Since the categories are not mutually exclusive, I’ll encode them as boolean.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>categories_snakecase <span class="ot">&lt;-</span> snakecase<span class="sc">::</span><span class="fu">to_snake_case</span>(categories)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(categories_snakecase))){</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  grant_opportunity_details <span class="ot">&lt;-</span> grant_opportunity_details <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span>categories_snakecase[i] <span class="sc">:</span><span class="er">=</span> agency_name <span class="sc">%in%</span> agencies_categorized[i][[<span class="dv">1</span>]])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</section>
</section>
<section id="data-analysis" class="level1">
<h1>Data analysis</h1>
<p>Now that I have a list of agency categories, I can do some analysis. One question I might ask is how much total estimated funding is allocated to each of the agency categories?</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&#39;category&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(), <span class="st">&#39;estimated_total_funding&#39;</span> <span class="ot">=</span> <span class="fu">c</span>())</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (c <span class="cf">in</span> categories_snakecase){</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  estimated_total_funding <span class="ot">&lt;-</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(<span class="fu">data.frame</span>(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;category&#39;</span> <span class="ot">=</span> c,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;estimated_total_funding&#39;</span> <span class="ot">=</span> <span class="fu">sum</span>((grant_opportunity_details <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(c)))<span class="sc">$</span>estimated_total_program_funding, <span class="at">na.rm=</span>T)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="ot">&lt;-</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">funding_billions =</span> numform<span class="sc">::</span><span class="fu">f_bills</span>(estimated_total_funding, <span class="at">digits=</span><span class="sc">-</span><span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(estimated_total_funding))</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(category, funding_billions)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    category funding_billions
1                     science_and_technology            52.9B
2                agriculture_and_environment            39.7B
3                     education_and_research            20.3B
4          infrastructure_and_transportation            17.7B
5          business_and_economic_development              16B
6  social_services_and_community_development            12.6B
7                       defense_and_military             9.4B
8                        health_and_medicine             2.6B
9                          international_aid             2.6B
10                          arts_and_culture              .1B</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(estimated_total_funding) <span class="ot">-&gt;</span> estimated_total_funding_ordered</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>estimated_total_funding_ordered <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(estimated_total_funding) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_inorder</span>(category), <span class="at">y =</span> estimated_total_funding)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Convert back from snake case to sentence case for better human readability</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">unique</span>(snakecase<span class="sc">::</span><span class="fu">to_sentence_case</span>(estimated_total_funding_ordered<span class="sc">$</span>category))) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">unit =</span> <span class="st">&quot;B&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-9</span>)) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Funding in Billions&#39;</span>, <span class="at">title =</span> <span class="st">&#39;Funding by US Government Agency Category&#39;</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="margin-caption img-fluid" width="672" /></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(&quot;social-image.png&quot;, height=960, width=1344, units = &#39;px&#39;, dpi=150)</span></span></code></pre></div>
</div>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Tyler Burleigh</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Tyler Burleigh</span> <span class="hidden" data-render-id="quarto-int-navbar:About">About</span> <span class="hidden" data-render-id="quarto-int-navbar:/index.html">/index.html</span> <span class="hidden" data-render-id="quarto-int-navbar:CV">CV</span> <span class="hidden" data-render-id="quarto-int-navbar:/cv/index.html">/cv/index.html</span> <span class="hidden" data-render-id="quarto-int-navbar:Blog">Blog</span> <span class="hidden" data-render-id="quarto-int-navbar:/blog/index.html">/blog/index.html</span> <span class="hidden" data-render-id="quarto-int-navbar:Research">Research</span> <span class="hidden" data-render-id="quarto-int-navbar:/research/index.html">/research/index.html</span> <span class="hidden" data-render-id="quarto-int-navbar:https://fosstodon.org/users/tylerburleigh">https://fosstodon.org/users/tylerburleigh</span> <span class="hidden" data-render-id="quarto-int-navbar:https://github.com/tylerburleigh">https://github.com/tylerburleigh</span> <span class="hidden" data-render-id="quarto-int-navbar:https://www.linkedin.com/in/tylerburleigh">https://www.linkedin.com/in/tylerburleigh</span> <span class="hidden" data-render-id="footer-left"><span class="faux-block"><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i></a> 2014–2022 Tyler Burleigh</span></span> <span class="hidden" data-render-id="footer-right"><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i>, <a href="https://quarto.org/">Quarto</a>, and the <a href="https://github.com/andrewheiss/ath-quarto">ath-quarto</a> theme</span></span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Using GPT-4 for classification | Tyler Burleigh</span> <span class="hidden" data-render-id="quarto-twittercardtitle">Using GPT-4 for classification | Tyler Burleigh</span> <span class="hidden" data-render-id="quarto-ogcardtitle">Using GPT-4 for classification | Tyler Burleigh</span> <span class="hidden" data-render-id="quarto-metasitename">Tyler Burleigh</span> <span class="hidden" data-render-id="quarto-twittercarddesc">In this post I’ll be tackling the Tidy Tuesday: US Government Grant Opportunities dataset. I’ll use GPT-4 to classify US grant-funding agencies into categories using government agency names. Then I’ll summarize how much agencies in each category are estimated to be giving out through grants.</span> <span class="hidden" data-render-id="quarto-ogcardddesc">In this post I’ll be tackling the Tidy Tuesday: US Government Grant Opportunities dataset. I’ll use GPT-4 to classify US grant-funding agencies into categories using government agency names. Then I’ll summarize how much agencies in each category are estimated to be giving out through grants.</span></p>
</div>
<!-- -->
<div class="quarto-embedded-source-code">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &#39;Using GPT-4 for classification&#39;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2023-10-08</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> &quot;In this post I&#39;ll be tackling the Tidy Tuesday: US Government Grant Opportunities dataset. I&#39;ll use GPT-4 to classify US grant-funding agencies into categories using government agency names. Then I&#39;ll summarize how much agencies in each category are estimated to be giving out through grants.&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> social-image.png</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">  image: &quot;social-image.png&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">  image: &quot;social-image.png&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - GPT</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - classification</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="an">freeze:</span><span class="co"> true</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>GPT is a powerful new tool in the Data Science toolkit. Used correctly, it can increase productivity while decreasing the &quot;drudgery&quot; of boring tasks like data cleaning. In this blog post, I use GPT to classify US grant-funding agencies into categories using government agency names. For this task I&#39;ll be using this week&#39;s Tidy Tuesday dataset: <span class="co">[</span><span class="ot">US Government Grant Opportunities</span><span class="co">](https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-10-03/readme.md)</span>.</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># Load libraries and data</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=F}</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keyring)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(numform)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(snakecase)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>grants <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-10-03/grants.csv&#39;</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>grant_opportunity_details <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-10-03/grant_opportunity_details.csv&#39;</span>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Load cached ChatGPT results from disk</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;categories.Rdata&#39;</span>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;agencies_categorized.Rdata&#39;</span>)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="fu"># GPT function</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>I&#39;ll define a function for querying ChatGPT (<span class="co">[</span><span class="ot">source</span><span class="co">](https://www.listendata.com/2023/05/chatgpt-in-r.html)</span>). This function will use GPT-4 as the model, and the temperature will be set to 0. Temperature defines how stable the responses will be. A temperature closer to 1 is better for creative tasks where high variability is desired, like creative writing. A temperature of 0 is more &quot;boring&quot; but also more stable. This is desirable for classification tasks.</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ChatGPT function</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>chatGPT <span class="ot">&lt;-</span> <span class="cf">function</span>(prompt, </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>                    <span class="at">modelName =</span> <span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>                    <span class="at">temperature =</span> <span class="dv">0</span>,</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>                    <span class="at">apiKey =</span> keyring<span class="sc">::</span><span class="fu">key_get</span>(<span class="st">&#39;openai&#39;</span>)) {</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">POST</span>(</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="st">&quot;https://api.openai.com/v1/chat/completions&quot;</span>, </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_headers</span>(<span class="at">Authorization =</span> <span class="fu">paste</span>(<span class="st">&quot;Bearer&quot;</span>, apiKey)),</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">content_type_json</span>(),</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">encode =</span> <span class="st">&quot;json&quot;</span>,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">body =</span> <span class="fu">list</span>(</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> modelName,</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">temperature =</span> temperature,</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">messages =</span> <span class="fu">list</span>(<span class="fu">list</span>(</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">role =</span> <span class="st">&quot;user&quot;</span>, </span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">content =</span> prompt</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">status_code</span>(response)<span class="sc">&gt;</span><span class="dv">200</span>) {</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">content</span>(response))</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trimws</span>(<span class="fu">content</span>(response)<span class="sc">$</span>choices[[<span class="dv">1</span>]]<span class="sc">$</span>message<span class="sc">$</span>content)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="fu"># List of agencies</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>I&#39;ll generate a distinct list of US government agencies in the dataset, and then format them as a comma-separated string. This will make it easy to append to a prompt string when querying GPT.</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>agencies <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(grants<span class="sc">$</span>agency_name))</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(agencies,<span class="at">collapse =</span> <span class="st">&#39;, &#39;</span>) <span class="ot">-&gt;</span> agencies_str</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a><span class="fu"># Using GPT for classification</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>I&#39;ll split the classification task into two parts:</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Give GPT the full list of agency names, and ask it to come up with N categories</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>For each of the N categories, give GPT the full list of agency names, and ask it to identify the agencies that belong in each category</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="fu"># 1. Ask it to come up with categories</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>First I&#39;ll ask GPT to define a fixed number of categories. Somewhat arbitrarily, I&#39;ll ask for 10.</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&#39;categories&#39;</span>)){</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>  query1 <span class="ot">&lt;-</span> </span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;I&#39;m going to present a list of US agencies. </span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a><span class="st">  Your task is to identify the 10 best categories </span></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="st">  to represent them. The categories should be based </span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="st">  on activities they&#39;re involved with, such as Defense </span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="st">  and Military, Science and Technology, Arts and Culture, </span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="st">  Health and Medicine, Education, International Aid, </span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="st">  etc... I want you to give me the list of categories </span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a><span class="st">  as a comma-separated list.</span></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="st">  ```&quot;</span>, agencies_str, <span class="st">&quot;```&quot;</span></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>  gpt_categories <span class="ot">&lt;-</span> <span class="fu">chatGPT</span>(query1)</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>  categories <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">strsplit</span>(gpt_categories, <span class="st">&quot;,&quot;</span>)[[<span class="dv">1</span>]])</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save to disk</span></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(categories, <span class="at">file =</span> <span class="st">&#39;categories.Rdata&#39;</span>)</span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(categories)</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Ask it to classify agencies using agency names and categories</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a>Next, using the agency names and categories generated above I&#39;ll ask GPT to do classification. First, I&#39;ll define a function that takes a category as input and runs a query against GPT asking it to put the agencies into the provided category, returning a list of agencies that it put in that category. Although I could ask GPT to classify agencies using all categories in a single query, I expect this would be less reliable than tackling each category separately. One of the trade-offs here is that I won&#39;t get mutual exclusivity of the categories, since GPT won&#39;t know how it&#39;s already classified agencies. For this analysis, let&#39;s assume I don&#39;t want mutual exclusivity.</span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>get_agencies_in_category <span class="ot">&lt;-</span> <span class="cf">function</span>(category) {</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>  query2 <span class="ot">&lt;-</span><span class="fu">paste0</span>(</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;I&#39;m going to present a comma-separated list of US agencies,</span></span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a><span class="st">  delimited by triple backticks (```), and a single category to </span></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a><span class="st">  which some of the agencies belong, delimited by triple hashtags (###). </span></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a><span class="st">  Your task is to provide a comma-separated list of agency names that </span></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a><span class="st">  belong in the category provided.</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a><span class="st">  ```&quot;</span>, agencies_str,  <span class="st">&quot;```</span></span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a><span class="st">  ###&quot;</span>, category, <span class="st">&quot;###&quot;</span></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a>  gpt_query2_response <span class="ot">&lt;-</span> <span class="fu">chatGPT</span>(query2)</span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return as a vector</span></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trimws</span>(<span class="fu">strsplit</span>(gpt_query2_response, <span class="st">&quot;,&quot;</span>)[[<span class="dv">1</span>]])</span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>Using the function above, I&#39;ll query GPT for each of the categories, saving the results into a list called <span class="in">`agencies_categorized`</span>.</span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&#39;agencies_categorized&#39;</span>)){</span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>  agencies_categorized <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (category <span class="cf">in</span> categories){</span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(category <span class="sc">!=</span> <span class="st">&#39;Other&#39;</span>){</span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a>      agencies_categorized[[category]] <span class="ot">&lt;-</span> <span class="fu">get_agencies_in_category</span>(category) </span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save to disk</span></span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(agencies_categorized, <span class="at">file =</span> <span class="st">&#39;agencies_categorized.Rdata&#39;</span>)</span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(agencies_categorized)</span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="fu">## Add categories to dataframe</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a>Finally, I&#39;ll add the category labels to the <span class="in">`grant_opportunity_details`</span> dataframe. Since the categories are not mutually exclusive, I&#39;ll encode them as boolean.</span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a>categories_snakecase <span class="ot">&lt;-</span> snakecase<span class="sc">::</span><span class="fu">to_snake_case</span>(categories)</span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(categories_snakecase))){</span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a>  grant_opportunity_details <span class="ot">&lt;-</span> grant_opportunity_details <span class="sc">%&gt;%</span></span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span>categories_snakecase[i] <span class="sc">:</span><span class="er">=</span> agency_name <span class="sc">%in%</span> agencies_categorized[i][[<span class="dv">1</span>]])</span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data analysis</span></span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a>Now that I have a list of agency categories, I can do some analysis. One question I might ask is how much total estimated funding is allocated to each of the agency categories?</span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&#39;category&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(), <span class="st">&#39;estimated_total_funding&#39;</span> <span class="ot">=</span> <span class="fu">c</span>())</span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (c <span class="cf">in</span> categories_snakecase){</span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a>  estimated_total_funding <span class="ot">&lt;-</span></span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a>    estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(<span class="fu">data.frame</span>(</span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;category&#39;</span> <span class="ot">=</span> c,</span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;estimated_total_funding&#39;</span> <span class="ot">=</span> <span class="fu">sum</span>((grant_opportunity_details <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(c)))<span class="sc">$</span>estimated_total_program_funding, <span class="at">na.rm=</span>T)</span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="ot">&lt;-</span> </span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>  estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">funding_billions =</span> numform<span class="sc">::</span><span class="fu">f_bills</span>(estimated_total_funding, <span class="at">digits=</span><span class="sc">-</span><span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(estimated_total_funding))</span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(category, funding_billions)</span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a>estimated_total_funding <span class="sc">%&gt;%</span></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(estimated_total_funding) <span class="ot">-&gt;</span> estimated_total_funding_ordered</span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a>estimated_total_funding_ordered <span class="sc">%&gt;%</span></span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(estimated_total_funding) <span class="sc">%&gt;%</span></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_inorder</span>(category), <span class="at">y =</span> estimated_total_funding)) <span class="sc">+</span></span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Convert back from snake case to sentence case for better human readability</span></span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">unique</span>(snakecase<span class="sc">::</span><span class="fu">to_sentence_case</span>(estimated_total_funding_ordered<span class="sc">$</span>category))) <span class="sc">+</span></span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">unit =</span> <span class="st">&quot;B&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-9</span>)) <span class="sc">+</span></span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Funding in Billions&#39;</span>, <span class="at">title =</span> <span class="st">&#39;Funding by US Government Agency Category&#39;</span>)</span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(&quot;social-image.png&quot;, height=960, width=1344, units = &#39;px&#39;, dpi=150)</span></span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
</div>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js"
        data-repo="tylerburleigh/tylerburleigh.github.io"
        data-repo-id="R_kgDOKMo8ww"
        data-category="Blog comments"
        data-category-id="DIC_kwDOIg6EJc4CSz92"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <div class='footer-contents'><span class="faux-block">[](https://creativecommons.org/licenses/by/4.0/) 2014–2022 Tyler Burleigh</span>
</div>  
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <div class='footer-contents'><span class="faux-block">Made with , [Quarto](https://quarto.org/), and the [ath-quarto](https://github.com/andrewheiss/ath-quarto) theme</span>
</div>  
    </div>
  </div>
</footer>

</body>

</html>